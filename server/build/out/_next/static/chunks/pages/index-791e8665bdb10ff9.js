(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(942)}])},942:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return eZ}});var n=r(5893),a=r(6886),i=r(7294),s=r(1163),o=r(5910),l=r(7357),c=r(2293),d=r(155),u=r(1496),m=r(3970),p=r(6506),h=r(7169),x=r(7533),g=r(8462),f=r(891),v=r(8987),Z=r(9661),j=r(9334),S=r(7720),y=r(8885),k=r(9653),b=r(6236),w=r(8761),C=r(6890),I=r(9029);function P(e){let{userAvatar:t,username:r}=e,[a,o]=(0,i.useState)({left:!1}),[c,d]=(0,i.useState)(!1),u=(0,s.useRouter)(),m=(e,t)=>r=>{("keydown"!==r.type||"Tab"!==r.key&&"Shift"!==r.key)&&o({...a,[e]:t})};return(0,i.useEffect)(()=>{if(!localStorage.getItem("theme")){localStorage.setItem("theme","light"),d(!1);return}"dark"===localStorage.getItem("theme")?d(!0):d(!1)},[]),(0,n.jsxs)(l.Z,{children:[(0,n.jsx)(b.Z,{onClick:m("left",!0),sx:{color:"primary.dark",cursor:"pointer"}}),(0,n.jsx)(x.ZP,{PaperProps:{sx:{width:"inherit",marginLeft:"10px",height:"99vh",cursor:"unset"}},anchor:"left",open:a.left,onClose:m("left",!1),children:(0,n.jsx)(l.Z,{sx:{width:"250px"},children:(0,n.jsxs)(g.Z,{children:[(0,n.jsxs)(f.ZP,{children:[(0,n.jsx)(v.Z,{children:(0,n.jsx)(Z.Z,{src:t})}),(0,n.jsx)(j.Z,{primary:r})]}),(0,n.jsx)(S.Z,{sx:{marginY:"20px"}}),(0,n.jsxs)(R,{onClick:()=>{let e=localStorage.getItem("username");if("dark"===localStorage.getItem("theme")){localStorage.setItem("theme","light"),h.Z.emit("change_theme",{theme:"light",user:e}),d(!1);return}if("light"===localStorage.getItem("theme")){localStorage.setItem("theme","dark"),h.Z.emit("change_theme",{theme:"dark",user:e}),d(!0);return}},children:[(0,n.jsx)(j.Z,{primary:"Theme"}),(0,n.jsx)(_,{checked:c}),(0,n.jsx)(y.Z,{children:c?(0,n.jsx)(w.Z,{}):(0,n.jsx)(C.Z,{})})]}),(0,n.jsxs)(R,{onClick:()=>{localStorage.removeItem("username"),localStorage.removeItem("accessToken"),u.push("/auth/login")},children:[(0,n.jsx)(j.Z,{primary:"Logout"}),(0,n.jsx)(y.Z,{children:(0,n.jsx)(I.Z,{})})]})]})})})]})}let _=(0,u.ZP)(k.Z)(e=>{let{theme:t}=e;return{"& .MuiSwitch-switchBase":{color:t.palette.primary.dark},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:t.palette.primary.dark},"& .MuiSwitch-switchBase.Mui-checked":{color:t.palette.primary.dark},"& .MuiSwitch-track":{backgroundColor:t.palette.primary.dark}}}),R=(0,u.ZP)(f.ZP)(e=>{let{theme:t}=e;return{transition:"0.2s","&:hover":{backgroundColor:t.palette.primary.main,borderRadius:"10px",transition:"0.2s",cursor:"pointer"}}});function A(e){let{users:t,handler:r}=e;return(0,n.jsx)(U,{children:t.map(e=>(0,n.jsxs)(N,{onClick:()=>r(e),children:[(0,n.jsx)(v.Z,{children:(0,n.jsx)(Z.Z,{src:e.avatar})}),(0,n.jsx)(j.Z,{primary:e.username})]},e.id))})}let N=(0,u.ZP)(f.ZP)(e=>{let{theme:t}=e;return{backgroundColor:t.palette.primary.dark,borderRadius:"10px",boxShadow:"4px 4px 8px 0px rgba(34, 60, 80, 0.2)",marginBottom:"5px",transition:"0.2s",cursor:"pointer","&:hover":{opacity:"0.8",transition:"0.2s"}}}),U=(0,u.ZP)(g.Z)(e=>{let{theme:t}=e;return{position:"absolute",width:"100%",height:"calc(99vh - 85px)",backgroundColor:t.palette.primary.main,borderRadius:"15px",zIndex:"2"}});var L=r(2729),E=r(7283);function T(){let e=(0,L._)(["\n  query GetUserInfo($username: String!) {\n    getUserInfo(userName: $username) {\n      email\n      username\n      avatar\n      createdAt\n      isOnline\n    }\n  }\n"]);return T=function(){return e},e}function M(){let e=(0,L._)(["\n  query GetUserChats($username: String!) {\n    getUserChats(userName: $username) {\n      id\n      createdAt\n      participants {\n        id\n        username\n        avatar\n        isOnline\n      }\n      messages {\n        id\n        content\n        createdAt\n        sender {\n          username\n        }\n      }\n    }\n  }\n"]);return M=function(){return e},e}function D(){let e=(0,L._)(["\n  query GetChatData($chatId: Int!) {\n    getChatData(chatId: $chatId) {\n      id\n      createdAt\n      participants {\n        id\n        username\n        avatar\n        isOnline\n      }\n      messages {\n        id\n        content\n        createdAt\n        sender {\n          username\n        }\n      }\n    }\n  }\n"]);return D=function(){return e},e}function z(){let e=(0,L._)(["\n  query SearchUsers($userName: String!) {\n    searchUsers(userName: $userName) {\n      id\n      avatar\n      username\n    }\n  }\n"]);return z=function(){return e},e}let O=(0,E.Ps)(T()),$=(0,E.Ps)(M()),B=(0,E.Ps)(D()),X=(0,E.Ps)(z());function q(e){let{userInfo:t}=e,[r,a]=(0,i.useState)(),[s]=(0,o.t)(X),[u,m]=(0,i.useState)(""),x=e=>{m(e.target.value)},g=async e=>{var t;let r=await s({variables:{userName:e}});a(null===(t=r.data)||void 0===t?void 0:t.searchUsers)};return(0,n.jsx)(n.Fragment,{children:t?(0,n.jsxs)(l.Z,{sx:{position:"relative"},children:[(0,n.jsx)(c.Z,{position:"static",variant:"elevation",children:(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(P,{userAvatar:t.avatar,username:t.username}),(0,n.jsxs)(W,{children:[(0,n.jsx)(G,{children:(0,n.jsx)(p.Z,{sx:{color:"primary.dark"}})}),(0,n.jsx)(Y,{placeholder:"Searchâ€¦",value:u,onChange:e=>{x(e),g(e.target.value)}})]})]})}),r&&(null==r?void 0:r.length)!==0?(0,n.jsx)(A,{handler:e=>{let t={firstUsername:localStorage.getItem("username"),secondUsername:e.username};h.Z.emit("create_chat",t),m(""),a([])},users:r}):""]}):""})}let W=(0,u.ZP)("div")(e=>{let{theme:t}=e;return{position:"relative",width:"100%",backgroundColor:t.palette.primary.light,borderRadius:"10px",marginLeft:"15px"}}),G=(0,u.ZP)("div")(e=>{let{theme:t}=e;return{padding:t.spacing(0,2),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"}}),Y=(0,u.ZP)(m.ZP)(e=>{let{theme:t}=e;return{color:"inherit",width:"100%","& .MuiInputBase-input":{padding:t.spacing(1,1,1,0),paddingLeft:"calc(1em + ".concat(t.spacing(4),")"),transition:t.transitions.create("width"),width:"100%"}}});var F=r(629),H=r(3321),J=r(5365);function K(e){let{message:t,handlerBtn:r,handlerInput:a,chatData:i}=e;return(0,n.jsxs)(Q,{children:[(0,n.jsx)(V,{onChange:e=>{a(e)},fullWidth:!0,placeholder:"Type here...",value:t,disabled:!i}),(0,n.jsx)(ee,{disabled:!i,onClick:()=>{r(t)},children:(0,n.jsx)(J.Z,{})})]})}let Q=(0,u.ZP)(F.Z)(e=>{let{theme:t}=e;return{display:"flex",position:"absolute",bottom:"0",borderRadius:"15px",width:"calc(100% - 0.5rem)",overflow:"hidden",alignItems:"center",margin:"auto","&:hover":{backgroundColor:t.palette.primary.light}}}),V=(0,u.ZP)(m.ZP)(e=>{let{theme:t}=e;return{backgroundColor:t.palette.primary.main,borderRadius:"15px",margin:"5px",padding:"10px 20px 10px 20px",border:"3px solid primary.dark",fontSize:"18px"}}),ee=(0,u.ZP)(H.Z)(e=>{let{theme:t}=e;return{height:"50px",marginLeft:"30px",padding:"0px 30px 0px 30px",backgroundColor:t.palette.primary.dark,borderRadius:"15px",transition:"0.2s","&:hover":{backgroundColor:t.palette.primary.dark,opacity:"0.8",transition:"0.2s"}}});var et=r(5861);function er(e){var t,r,a;let{messages:s,participants:o}=e,[c,d]=(0,i.useState)(()=>2===o.length&&localStorage.getItem("username")===o[0].username?o[1].username:o[0].username),[u,m]=(0,i.useState)(()=>2===o.length&&localStorage.getItem("username")===o[0].username?o[1].avatar:o[0].avatar);return(0,n.jsx)(F.Z,{sx:{"&:hover":{opacity:"0.8"}},children:(0,n.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center",height:"100%"},children:[(0,n.jsx)(Z.Z,{alt:"avatar",src:u,sx:{width:65,height:65}}),(0,n.jsxs)(en,{children:[(0,n.jsxs)(ea,{children:[(0,n.jsx)(et.Z,{fontSize:"14px",fontWeight:"bold",children:c}),(0,n.jsx)(et.Z,{fontSize:"12px",children:(null===(t=s[0])||void 0===t?void 0:t.createdAt)?new Date(Number(null===(r=s[0])||void 0===r?void 0:r.createdAt)).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}).toString():""})]}),(0,n.jsx)(ea,{children:(0,n.jsx)(et.Z,{sx:{fontSize:"14px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:(null===(a=s[0])||void 0===a?void 0:a.content)||"No messages"})})]})]})})}let en=(0,u.ZP)(l.Z)(e=>{let{theme:t}=e;return{display:"flex",flexDirection:"column",justifyContent:"space-between",width:"calc(100% - 75px)",height:"100%",marginLeft:"10px"}}),ea=(0,u.ZP)(l.Z)(e=>{let{theme:t}=e;return{display:"flex",justifyContent:"space-between",alignItems:"center"}});function ei(e){let{userChats:t,handler:r}=e;return(0,n.jsx)(es,{children:t&&0!==t.length?t.map(e=>(0,n.jsx)(l.Z,{onClick:()=>r(e.id),children:(0,n.jsx)(er,{participants:e.participants,messages:e.messages,id:e.id,createdAt:e.createdAt})},e.id)):(0,n.jsx)(et.Z,{sx:{textAlign:"center",marginTop:"50px",color:"primary.dark"},variant:"h5",children:"No chats"})})}let es=(0,u.ZP)(l.Z)(e=>{let{theme:t}=e;return{backgroundColor:t.palette.primary.main,height:"calc(99vh - 85px)",borderRadius:"15px",overflowY:"scroll",padding:"5px"}});var eo=r(7850),el=r(8972),ec=r(4685);function ed(e){let{chatId:t,chatUsers:r}=e,[a,s]=(0,i.useState)(null),o=()=>s(null),c=(e,t)=>{h.Z.emit("delete_chat",{chatId:e,users:t})},d=(e,t)=>{h.Z.emit("delete_messages",{chatId:e,users:t})};return(0,n.jsxs)(l.Z,{children:[(0,n.jsx)(ec.Z,{sx:{color:"primary.dark",cursor:"pointer"},onClick:e=>s(e.currentTarget)}),(0,n.jsxs)(eo.Z,{sx:{"& .MuiMenu-paper":{width:"max-content",height:"max-content","&:hover":{bgcolor:"primary.light"}}},anchorEl:a,open:!!a,onClose:o,transformOrigin:{vertical:"top",horizontal:"right"},children:[(0,n.jsx)(el.Z,{sx:{transition:"0.2s","&:hover":{borderRadius:"5px",transition:"0.2s"}},onClick:()=>{o(),d(t,[r[0].username,r[1].username])},children:"Delete messages"}),(0,n.jsx)(el.Z,{sx:{transition:"0.2s","&:hover":{borderRadius:"5px",transition:"0.2s"}},onClick:()=>{o(),c(t,[r[0].username,r[1].username])},children:"Delete chat"})]})]})}var eu=r(6812);function em(e){let{username:t,chatId:r,chatUsers:a,isOnline:i}=e;return(0,n.jsx)(l.Z,{children:(0,n.jsx)(c.Z,{variant:"elevation",position:"static",children:(0,n.jsxs)(d.Z,{sx:{justifyContent:"space-between"},children:[(0,n.jsxs)(l.Z,{children:[(0,n.jsx)(et.Z,{variant:"h6",children:t}),i?(0,n.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,n.jsx)(et.Z,{sx:{marginRight:"10px"},children:"Online"}),(0,n.jsx)(eu.Z,{sx:{fontSize:"10px",color:"primary.dark"}})]}):"Offline"]}),(0,n.jsx)(ed,{chatId:r,chatUsers:a})]})})})}let ep=(0,u.ZP)(l.Z)(e=>{let{theme:t}=e;return{backgroundColor:t.palette.primary.dark,borderRadius:"10px",display:"flex",maxWidth:"500px",width:"fit-content",padding:"5px 10px 5px 10px",justifyContent:"space-between",alignItems:"end",margin:"15px",marginLeft:"auto",marginRight:"0px"}});function eh(e){let{message:t,createdAt:r}=e;return(0,n.jsxs)(ep,{children:[(0,n.jsx)(et.Z,{sx:{marginRight:"5px",fontSize:"16px",color:"#ffffff"},children:t}),(0,n.jsx)(et.Z,{sx:{marginLeft:"5px",fontSize:"12px",color:"#fafafa"},children:new Date(Number(r)).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}).toString()})]})}let ex=(0,u.ZP)(l.Z)(e=>{let{theme:t}=e;return{backgroundColor:t.palette.primary.light,borderRadius:"10px",display:"flex",maxWidth:"500px",width:"fit-content",padding:"5px 10px 5px 10px",justifyContent:"space-between",alignItems:"end",margin:"15px"}});function eg(e){let{message:t,createdAt:r}=e;return(0,n.jsxs)(ex,{children:[(0,n.jsx)(et.Z,{sx:{marginRight:"5px",fontSize:"16px"},children:t}),(0,n.jsx)(et.Z,{sx:{marginLeft:"5px",fontSize:"12px",color:"#aaaaaa"},children:new Date(Number(r)).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}).toString()})]})}function ef(e){let{userChatData:t}=e;return(0,n.jsxs)(n.Fragment,{children:[t?(0,n.jsx)(em,{username:t.participants[0].username===localStorage.getItem("username")?t.participants[1].username:t.participants[0].username,chatId:t.id,chatUsers:t.participants,isOnline:t.participants[0].username===localStorage.getItem("username")?t.participants[1].isOnline:t.participants[0].isOnline}):"",(0,n.jsx)(ev,{sx:{paddingBottom:"75px"},children:t?0===t.messages.length?(0,n.jsx)(et.Z,{sx:{textAlign:"center",marginTop:"150px",color:"primary.dark"},variant:"h5",children:"No messages"}):t.messages.map(e=>localStorage.getItem("username")===e.sender.username?(0,n.jsx)(eh,{message:e.content,createdAt:e.createdAt},e.id):(0,n.jsx)(eg,{message:e.content,createdAt:e.createdAt},e.id)):(0,n.jsx)(et.Z,{sx:{textAlign:"center",marginTop:"150px",color:"primary.dark"},variant:"h5",children:"Select who you want to write to..."})})]})}let ev=(0,u.ZP)(l.Z)(e=>{let{theme:t}=e;return{backgroundColor:t.palette.primary.main,height:"calc(99vh - 85px)",borderRadius:"15px",overflowY:"scroll",padding:"5px"}});function eZ(){let e=(0,s.useRouter)(),[t,r]=(0,i.useState)(),[l,c]=(0,i.useState)(),[d,u]=(0,i.useState)(),[m,p]=(0,i.useState)(),[x,g]=(0,i.useState)(""),[f,v]=(0,i.useState)([2.95,8.95]),[Z,j]=(0,i.useState)([4,8]),[S]=(0,o.t)(O),[y]=(0,o.t)($),[k]=(0,o.t)(B),b=(0,i.useRef)(null),w=(0,i.useRef)(null),C=async e=>{var t;let r=await k({variables:{chatId:e}}),n=null===(t=r.data)||void 0===t?void 0:t.getChatData;n&&(null==n?void 0:n.participants.length)!==2&&(n={...n,participants:[n.participants[0],n.participants[0]]}),u(n)};(0,i.useEffect)(()=>{if(!localStorage.getItem("username")){e.push("/auth/login");return}(async()=>{var e,t,n,a;try{let a={username:localStorage.getItem("username")},[i,s]=await Promise.all([S({variables:a}),y({variables:a})]);(null===(e=s.data)||void 0===e?void 0:e.getUserChats)&&c([...null===(n=s.data)||void 0===n?void 0:n.getUserChats].sort((e,t)=>Number(t.messages[0].createdAt)-Number(e.messages[0].createdAt))),r(null===(t=i.data)||void 0===t?void 0:t.getUserInfo),h.Z.emit("join_own_room",localStorage.getItem("username"))}catch(e){p(null===(a=e.networkError)||void 0===a?void 0:a.result.errors[0].message);return}})()},[]),(0,i.useEffect)(()=>{h.Z.on("message",e=>{e.createdAt=String(Date.now()),d&&u({...d,messages:[...d.messages,e]}),c(t=>{let r=null==t?void 0:t.map(t=>t.id===e.chatId?{...t,messages:[e]}:t);return null==r||r.sort((e,t)=>Number(t.messages[0].createdAt)-Number(e.messages[0].createdAt)),r})}),h.Z.on("created_chat",e=>{l?c([e,...l]):c([e])}),h.Z.on("chat_deleted",e=>{c(t=>null==t?void 0:t.filter(t=>t.id!==e.id)),u(void 0)}),h.Z.on("messages_deleted",e=>{u(e=>e?{...e,messages:[]}:e),c(t=>null==t?void 0:t.map(t=>t.id===e?{...t,messages:[]}:t))})},[d,l]);let I=(0,i.useCallback)(e=>{let t=Math.abs(e.movementX/200);e.movementX>0&&(v([f[0]+=t,f[1]-=t]),j([Z[0]+=t,Z[1]-=t])),e.movementX<0&&(v([f[0]-=t,f[1]+=t]),j([Z[0]-=t,Z[1]+=t]))},[]),P=(e,t)=>{e.currentTarget.addEventListener("mousemove",I),null==t||t.addEventListener("mousemove",I)},_=(e,t)=>{e.currentTarget.removeEventListener("mousemove",I),null==t||t.removeEventListener("mousemove",I)};return(0,n.jsxs)(a.ZP,{container:!0,padding:.5,ref:b,onMouseUp:e=>_(e,w.current),children:[(0,n.jsxs)(a.ZP,{item:!0,md:f[0],sm:Z[0],children:[(0,n.jsx)(q,{userInfo:t}),(0,n.jsx)(ei,{userChats:l,handler:C})]}),(0,n.jsx)(a.ZP,{item:!0,md:.1,sm:.1,sx:{cursor:"col-resize"},ref:w,onMouseDown:e=>P(e,b.current),onMouseUp:e=>_(e,b.current)}),(0,n.jsxs)(a.ZP,{item:!0,md:f[1],sm:Z[1],sx:{position:"relative"},children:[(0,n.jsx)(ef,{userChatData:d}),(0,n.jsx)(K,{chatData:d,message:x,handlerInput:e=>{g(e.target.value)},handlerBtn:e=>{if(!e)return;if(!d){g("");return}let t=d.participants,r=[t[0].username,t[1].username],n=t[0].username===localStorage.getItem("username")?t[0].id:t[1].id,a=t[0].username===localStorage.getItem("username")?t[1].id:t[0].id,i={content:e,chatId:d.id,senderId:n,receiverId:a};h.Z.emit("message",{msg:i,room:r}),g("")}})]})]})}}},function(e){e.O(0,[144,525,696,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);